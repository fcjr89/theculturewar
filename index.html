<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    
    <title>The Culture War - Choose Your Pill</title>
    <meta name="description" content="The Culture War - A gamer's perspective on society. Matrix-themed retro website. Choose the red pill or blue pill.">
    <meta name="keywords" content="gaming, culture war, matrix, red pill, blue pill, cyberpunk, retro gaming, social commentary">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://pilled.net">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Press Start 2P', monospace;
            background: #000;
            color: #0f0;
            overflow-x: hidden;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
            will-change: transform;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .glitch {
            animation: glitch 1s infinite;
        }

        @keyframes glitch {
            0% { text-shadow: 2px 2px #ff00ff, -2px -2px #00ffff; }
            25% { text-shadow: -2px 2px #ff00ff, 2px -2px #00ffff; }
            50% { text-shadow: 2px -2px #ff00ff, -2px 2px #00ffff; }
            75% { text-shadow: -2px -2px #ff00ff, 2px 2px #00ffff; }
            100% { text-shadow: 2px 2px #ff00ff, -2px -2px #00ffff; }
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 4px solid #0f0;
            margin-bottom: 40px;
        }

        h1 {
            font-size: clamp(1.2em, 5vw, 2.5em);
            margin-bottom: 20px;
            text-shadow: 0 0 20px #0f0;
            word-wrap: break-word;
        }

        .subtitle {
            font-size: clamp(0.5em, 2vw, 0.8em);
            color: #0f0;
            margin: 20px 0;
            line-height: 1.8;
        }

        .image-container {
            width: 100%;
            max-width: 800px;
            margin: 40px auto;
            border: 4px solid #0f0;
            box-shadow: 0 0 30px #0f0;
            position: relative;
            overflow: hidden;
        }

        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            filter: contrast(1.2) brightness(0.9);
        }

        .intro-box {
            background: rgba(0, 20, 0, 0.9);
            border: 3px solid #0f0;
            padding: clamp(20px, 5vw, 30px);
            margin: 40px auto;
            max-width: 700px;
            box-shadow: 0 0 20px #0f0;
        }

        .intro-box p {
            font-size: clamp(0.5em, 1.5vw, 0.7em);
            line-height: 2;
            text-align: center;
        }

        .pill-container {
            display: flex;
            justify-content: center;
            gap: clamp(20px, 5vw, 60px);
            margin: 60px 0;
            flex-wrap: wrap;
        }

        .pill {
            background: rgba(0, 20, 0, 0.8);
            border: 3px solid;
            padding: clamp(20px, 4vw, 30px);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            min-width: clamp(150px, 30vw, 200px);
            text-align: center;
            touch-action: manipulation;
        }

        .pill:active {
            transform: scale(0.95);
        }

        .pill:hover {
            transform: scale(1.05);
        }

        .red-pill {
            border-color: #ff0000;
            color: #ff0000;
        }

        .red-pill:hover, .red-pill:active {
            box-shadow: 0 0 40px #ff0000;
            background: rgba(255, 0, 0, 0.2);
        }

        .blue-pill {
            border-color: #0088ff;
            color: #0088ff;
        }

        .blue-pill:hover, .blue-pill:active {
            box-shadow: 0 0 40px #0088ff;
            background: rgba(0, 136, 255, 0.2);
        }

        .pill h2 {
            font-size: clamp(0.8em, 2vw, 1.2em);
            margin-bottom: 20px;
        }

        .pill p {
            font-size: clamp(0.4em, 1.2vw, 0.6em);
            line-height: 1.8;
        }

        .counter {
            margin-top: 20px;
            font-size: clamp(0.5em, 1.5vw, 0.8em);
        }

        /* KALSHI SECTION */
        .kalshi-section {
            margin: 40px auto;
            max-width: 1000px;
            background: rgba(0, 20, 0, 0.9);
            border: 4px solid #0f0;
            padding: clamp(20px, 5vw, 40px);
            box-shadow: 0 0 40px #0f0;
        }

        .kalshi-section h2 {
            font-size: clamp(0.8em, 2.5vw, 1.2em);
            margin-bottom: 30px;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
            text-align: center;
        }

        .kalshi-markets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .kalshi-market {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #0f0;
            padding: 20px;
            transition: all 0.3s;
        }

        .kalshi-market:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
        }

        .market-title {
            font-size: 0.7em;
            color: #fff;
            margin-bottom: 15px;
            line-height: 1.4;
            min-height: 60px;
        }

        .market-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.5em;
            color: #888;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        }

        .market-category {
            color: #0f0;
        }

        .market-prices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .price-yes, .price-no {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid;
            padding: 10px;
            text-align: center;
        }

        .price-yes {
            border-color: #00ff00;
        }

        .price-no {
            border-color: #ff0000;
        }

        .price-label {
            display: block;
            font-size: 0.5em;
            margin-bottom: 5px;
        }

        .price-value {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
        }

        .market-link {
            display: block;
            text-align: center;
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            color: #0f0;
            text-decoration: none;
            font-size: 0.5em;
            transition: all 0.3s;
        }

        .market-link:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 15px #0f0;
        }

        .stream-container {
            margin: 40px auto;
            max-width: 1000px;
            background: rgba(0, 20, 0, 0.9);
            border: 4px solid #0f0;
            padding: clamp(10px, 3vw, 20px);
            box-shadow: 0 0 40px #0f0;
            position: relative;
        }

        .stream-frame {
            position: relative;
            background: #000;
            border: 2px solid #0f0;
        }

        .live-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff0000;
            color: #fff;
            padding: clamp(5px, 1.5vw, 8px) clamp(10px, 2.5vw, 15px);
            font-size: clamp(0.4em, 1.2vw, 0.6em);
            z-index: 10;
            border: 2px solid #fff;
            box-shadow: 0 0 20px #ff0000;
            animation: livepulse 2s infinite;
        }

        @keyframes livepulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .stream-frame iframe {
            display: block;
            width: 100%;
            height: clamp(300px, 60vh, 95vh);
            border: none;
        }

        /* CHAT SECTION */
        .chat-section {
            margin: 40px auto;
            max-width: 1000px;
            background: rgba(0, 20, 0, 0.9);
            border: 4px solid #0f0;
            padding: clamp(20px, 4vw, 30px);
            box-shadow: 0 0 40px #0f0;
        }

        .chat-section h2 {
            font-size: clamp(0.8em, 2.5vw, 1.2em);
            margin-bottom: 20px;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
            text-align: center;
        }

        .chat-container {
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #0f0;
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            scrollbar-width: thin;
            scrollbar-color: #0f0 #000;
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: #000;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background-color: #0f0;
            border-radius: 4px;
        }

        .message {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s;
            position: relative;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: rgba(0, 50, 0, 0.7);
            border-left: 4px solid #0f0;
            align-self: flex-end;
            text-align: right;
        }

        .message.other {
            background: rgba(0, 0, 0, 0.7);
            border-right: 4px solid #0088ff;
            align-self: flex-start;
        }

        .message.system {
            background: rgba(50, 0, 0, 0.7);
            border-left: 4px solid #ff0000;
            align-self: center;
            text-align: center;
            font-style: italic;
            max-width: 90%;
        }

        .message-username {
            font-size: 0.6em;
            color: #888;
            margin-bottom: 5px;
        }

        .message-text {
            font-size: 0.7em;
            line-height: 1.5;
        }

        .message-time {
            font-size: 0.5em;
            color: #666;
            margin-top: 5px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .username-input {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px 15px;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.6em;
            min-width: 120px;
            flex-shrink: 0;
        }

        .username-input:focus {
            outline: none;
            box-shadow: 0 0 10px #0f0;
        }

        .message-input {
            flex-grow: 1;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px 15px;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.6em;
        }

        .message-input:focus {
            outline: none;
            box-shadow: 0 0 10px #0f0;
        }

        .send-button {
            background: rgba(0, 20, 0, 0.8);
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.6em;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .send-button:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 15px #0f0;
        }

        .send-button:active {
            transform: scale(0.95);
        }

        .link-box {
            text-align: center;
            margin: 60px 0;
        }

        .captains-log-button {
            display: inline-block;
            padding: clamp(15px, 3vw, 20px) clamp(30px, 6vw, 40px);
            background: rgba(0, 20, 0, 0.8);
            border: 3px solid #8B4513;
            color: #FFD700;
            text-decoration: none;
            font-size: clamp(0.5em, 1.5vw, 0.8em);
            transition: all 0.3s;
            box-shadow: 0 0 20px #FFD700;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
        }

        .captains-log-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            transition: left 0.5s;
        }

        .captains-log-button:hover:before {
            left: 100%;
        }

        .captains-log-button:hover, .captains-log-button:active {
            background: rgba(139, 69, 19, 0.3);
            transform: scale(1.05);
            box-shadow: 0 0 40px #FFD700, 0 0 60px #8B4513;
            border-color: #FFD700;
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 0, 0, 0.15) 3px
            );
            pointer-events: none;
            z-index: 999;
        }

        .section-divider {
            text-align: center;
            margin: 60px 0 30px 0;
            font-size: clamp(0.8em, 2.5vw, 1.2em);
            color: #0f0;
            text-shadow: 0 0 20px #0f0;
        }

        footer {
            text-align: center;
            padding: 40px 0;
            border-top: 4px solid #0f0;
            margin-top: 60px;
            font-size: clamp(0.4em, 1.2vw, 0.6em);
            line-height: 1.8;
        }

        .loader {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            min-height: 100px;
        }

        .loader:after {
            content: '';
            display: block;
            width: 30px;
            height: 30px;
            box-sizing: border-box;
            margin: 0;
            border: 2px solid #0f0;
            border-right-color: transparent;
            border-radius: 100%;
            animation: spinner .65s infinite linear;
            transform-origin: center;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-msg {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 14px;
            color: #ff0000;
            padding: 20px;
            font-weight: 400;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .kalshi-markets {
                grid-template-columns: 1fr;
            }

            .stream-frame iframe {
                height: 50vh;
            }

            .chat-input-container {
                flex-direction: column;
            }

            .username-input {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>
    <div class="scanlines"></div>
    
    <div class="container">
        <header>
            <h1 class="glitch">THE CULTURE WAR</h1>
            <p class="subtitle">‚öîÔ∏è A Digital Battlefield ‚öîÔ∏è</p>
        </header>

        <div class="image-container">
            <img src="522d5da8-a9f1-44b8-b5d2-e95f7e37ed99.jpg" alt="The Culture War Split Reality" loading="lazy">
        </div>

        <div class="intro-box">
            <p>
                > I'M JUST SOME GUY ON THE INTERNET<br>
                > A GAMER WHO OBSERVES OUR<br>
                > CHAOTIC STUPID SOCIETY<br><br>
                > WELCOME TO THE SIMULATION_
            </p>
        </div>

        <div class="pill-container">
            <div class="pill red-pill" onclick="choosePill('red')" role="button" tabindex="0" aria-label="Choose Red Pill">
                <h2>RED PILL üíä</h2>
                <p>WAKE UP<br>SEE THE TRUTH<br>FACE REALITY<br>NO GOING BACK</p>
                <div class="counter">CHOSEN: <span id="red-count">0</span></div>
            </div>

            <div class="pill blue-pill" onclick="choosePill('blue')" role="button" tabindex="0" aria-label="Choose Blue Pill">
                <h2>BLUE PILL üíä</h2>
                <p>STAY ASLEEP<br>IGNORANCE IS BLISS<br>COMFORTABLE LIES<br>DREAM ON</p>
                <div class="counter">CHOSEN: <span id="blue-count">0</span></div>
            </div>
        </div>

        <div class="section-divider">
            &gt;&gt;&gt; LIVE TRANSMISSION &lt;&lt;&lt;
        </div>

        <div class="stream-container">
            <div class="stream-frame">
                <div class="live-indicator">‚óè LIVE STREAM</div>
                <iframe 
                    allow="autoplay" 
                    allowfullscreen 
                    loading="lazy"
                    src="https://pilled.net/foxhole/141114/iframe?theme=galaxy" 
                    title="Live Stream"
                    style="height: 95vh; width: 100%; display: block;">
                </iframe>
            </div>
        </div>

        <div class="section-divider">
            &gt;&gt;&gt; LIVE CHAT &lt;&lt;&lt;
        </div>

        <div class="chat-section">
            <h2>üí¨ LIVE DISCUSSION</h2>
            <div id="chatContainer" class="chat-container">
                <div class="message system">
                    <div class="message-text">Welcome to the Culture War chat. Be respectful.</div>
                    <div class="message-time">System Message</div>
                </div>
                <div class="message other">
                    <div class="message-username">MatrixObserver</div>
                    <div class="message-text">Anyone else seeing this stream? The simulation is glitching hard today.</div>
                    <div class="message-time">Just now</div>
                </div>
                <div class="message user">
                    <div class="message-username">RedPilledUser</div>
                    <div class="message-text">I took the red pill years ago. Wake up sheeple!</div>
                    <div class="message-time">2 min ago</div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="usernameInput" class="username-input" placeholder="Username" maxlength="15" value="User">
                <input type="text" id="messageInput" class="message-input" placeholder="Type your message..." maxlength="200">
                <button id="sendButton" class="send-button">SEND</button>
            </div>
        </div>

        <div class="section-divider">
            &gt;&gt;&gt; PREDICTION MARKETS &lt;&lt;&lt;
        </div>

        <div class="kalshi-section">
            <h2>üìä KALSHI PREDICTION MARKETS</h2>
            <div id="kalshiMarkets" class="kalshi-markets">
                <div class="loader"></div>
            </div>
        </div>

        <div class="link-box">
            <a href="https://thecaptainslog.xyz" class="captains-log-button" target="_blank" rel="noopener">
                ‚öì ENTER THE CAPTAIN'S LOG_
            </a>
        </div>

        <footer>
            <p>&gt; THE CULTURE WAR - DIGITAL BATTLEFIELD</p>
            <p>&gt; POWERED BY CHAOS AND OBSERVATIONS</p>
            <p>&gt; MADE BY JUST SOME GUY‚Ñ¢</p>
        </footer>
    </div>

    <script>
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const matrix = "THECULTUREWAR01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà";
        const fontSize = isMobile ? 12 : 14;
        const columns = Math.floor(canvas.width / fontSize);
        const drops = Array(columns).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0f0';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = matrix[Math.floor(Math.random() * matrix.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        const animationSpeed = isMobile ? 80 : 50;
        setInterval(drawMatrix, animationSpeed);

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }, 250);
        });

        // ==========================================
        // CHAT FUNCTIONALITY
        // ==========================================
        const chatContainer = document.getElementById('chatContainer');
        const usernameInput = document.getElementById('usernameInput');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        // Sample user names for simulated responses
        const sampleUsers = [
            'RedPilledUser', 'BluePillTaker', 'MatrixObserver', 
            'GlitchInSystem', 'NeoWannabe', 'MorpheusFan', 
            'SimulationTest', 'RealityChecker', 'TruthSeeker'
        ];

        // Sample messages for simulated responses
        const sampleMessages = [
            "The red pill changed everything for me",
            "Has anyone noticed the patterns in the simulation?",
            "This stream is revealing some hard truths",
            "They don't want you to know what's really happening",
            "I chose blue and I'm happy with my decision",
            "The system is designed to keep us asleep",
            "Wake up people! The signs are everywhere",
            "What if we're all just characters in someone else's story?",
            "The culture war is a distraction from the real issues"
        ];

        // Function to add a message to the chat
        function addMessage(username, text, type = 'user') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const usernameDiv = document.createElement('div');
            usernameDiv.className = 'message-username';
            usernameDiv.textContent = username;
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.textContent = text;
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = 'Just now';
            
            messageDiv.appendChild(usernameDiv);
            messageDiv.appendChild(textDiv);
            messageDiv.appendChild(timeDiv);
            
            chatContainer.appendChild(messageDiv);
            
            // Scroll to bottom to show new message
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // If this is a user message, simulate responses
            if (type === 'user') {
                simulateResponses();
            }
        }

        // Function to simulate other users responding
        function simulateResponses() {
            // Random chance of getting a response (60%)
            if (Math.random() < 0.6) {
                // Number of responses (1-2)
                const responseCount = Math.floor(Math.random() * 2) + 1;
                
                for (let i = 0; i < responseCount; i++) {
                    // Random delay between responses
                    const delay = 1000 + Math.random() * 4000;
                    
                    setTimeout(() => {
                        const randomUser = sampleUsers[Math.floor(Math.random() * sampleUsers.length)];
                        const randomMessage = sampleMessages[Math.floor(Math.random() * sampleMessages.length)];
                        
                        addMessage(randomUser, randomMessage, 'other');
                    }, delay);
                }
            }
        }

        // Function to handle sending a message
        function sendMessage() {
            const username = usernameInput.value.trim() || 'User';
            const message = messageInput.value.trim();
            
            if (message) {
                addMessage(username, message, 'user');
                messageInput.value = '';
                
                // Simulate occasional system messages
                if (Math.random() < 0.1) {
                    setTimeout(() => {
                        addMessage('System', 'Remember to be respectful in discussions.', 'system');
                    }, 2000);
                }
            }
        }

        // Event listeners for chat
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ==========================================
        // KALSHI MARKETS - PUBLIC API
        // ==========================================
        const KALSHI_BASE_URL = 'https://api.kalshi.co/trade-api/v2';

        async function loadKalshiMarkets() {
            const kalshiSection = document.getElementById('kalshiMarkets');
            
            if (!kalshiSection) {
                console.log('Kalshi section not found');
                return;
            }
            
            kalshiSection.innerHTML = '<div class="loader"></div>';
            
            try {
                console.log('üìä Loading Kalshi markets...');
                
                const response = await fetch(`${KALSHI_BASE_URL}/markets?limit=12&status=open`, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Markets loaded:', data);
                
                if (data.markets && data.markets.length > 0) {
                    // Filter for politics and culture markets
                    const filteredMarkets = data.markets.filter(market => {
                        const category = market.category?.toLowerCase() || '';
                        const title = market.title?.toLowerCase() || '';
                        return category.includes('politics') || 
                               category.includes('culture') || 
                               title.includes('election') ||
                               title.includes('political') ||
                               title.includes('culture');
                    }).slice(0, 6); // Show top 6 relevant markets
                    
                    displayKalshiMarkets(filteredMarkets);
                } else {
                    kalshiSection.innerHTML = '<p class="error-msg">No active markets</p>';
                }
                
            } catch (error) {
                console.error('‚ùå Kalshi error:', error);
                kalshiSection.innerHTML = `
                    <div class="error-msg">
                        <p>Could not load markets</p>
                        <p style="font-size:12px;margin-top:10px;">${error.message}</p>
                    </div>
                `;
            }
        }

        function displayKalshiMarkets(markets) {
            const kalshiSection = document.getElementById('kalshiMarkets');
            
            if (markets.length === 0) {
                kalshiSection.innerHTML = '<p class="error-msg">No politics/culture markets found</p>';
                return;
            }
            
            const html = markets.map(market => {
                const title = market.title || 'Unknown Market';
                const category = market.category || 'General';
                const volume = market.volume || 0;
                const yesPrice = market.yes_ask || market.last_price || '‚Äî';
                const noPrice = market.no_ask || (100 - (market.last_price || 0)) || '‚Äî';
                const ticker = market.ticker || market.ticker_name || '';
                
                return `
                    <div class="kalshi-market">
                        <div class="market-title">${title}</div>
                        <div class="market-info">
                            <span class="market-category">${category.toUpperCase()}</span>
                            <span class="market-volume">$${volume.toLocaleString()}</span>
                        </div>
                        <div class="market-prices">
                            <div class="price-yes">
                                <span class="price-label">YES</span>
                                <span class="price-value">${yesPrice}¬¢</span>
                            </div>
                            <div class="price-no">
                                <span class="price-label">NO</span>
                                <span class="price-value">${noPrice}¬¢</span>
                            </div>
                        </div>
                        ${ticker ? `
                            <a href="https://kalshi.com/markets/${ticker}" 
                               target="_blank" 
                               rel="noopener" 
                               class="market-link">
                                TRADE ON KALSHI ‚Üí
                            </a>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            kalshiSection.innerHTML = html;
        }

        // ==========================================
        // PILL CHOICE SYSTEM
        // ==========================================
        let redCount = parseInt(localStorage.getItem('redPillCount')) || 0;
        let blueCount = parseInt(localStorage.getItem('bluePillCount')) || 0;
        document.getElementById('red-count').textContent = redCount;
        document.getElementById('blue-count').textContent = blueCount;

        function choosePill(color) {
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }

            if (color === 'red') {
                redCount++;
                localStorage.setItem('redPillCount', redCount);
                document.getElementById('red-count').textContent = redCount;
                alert('‚ö†Ô∏è YOU CHOSE THE RED PILL ‚ö†Ô∏è\n\nYou cannot unlearn what you know.\nThe matrix has you...\nFollow the white rabbit.');
                
                // Add to chat
                const username = usernameInput.value.trim() || 'User';
                addMessage(username, 'I just took the RED PILL! There\'s no going back now!', 'user');
                
                document.body.style.background = '#300';
                setTimeout(() => { document.body.style.background = '#000'; }, 200);
            } else {
                blueCount++;
                localStorage.setItem('bluePillCount', blueCount);
                document.getElementById('blue-count').textContent = blueCount;
                alert('üò¥ YOU CHOSE THE BLUE PILL üò¥\n\nThe story ends here.\nYou wake up in your bed.\nYou believe whatever you want to believe.');
                
                // Add to chat
                const username = usernameInput.value.trim() || 'User';
                addMessage(username, 'I took the BLUE PILL. Ignorance is bliss!', 'user');
                
                document.body.style.background = '#003';
                setTimeout(() => { document.body.style.background = '#000'; }, 200);
            }
        }

        document.querySelectorAll('.pill').forEach(pill => {
            pill.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    pill.click();
                }
            });
        });

        window.addEventListener('load', () => {
            console.log('üéÆ Page loaded');
            
            if (document.getElementById('kalshiMarkets')) {
                loadKalshiMarkets();
                
                // Auto-refresh markets every 2 minutes
                setInterval(() => {
                    console.log('üîÑ Refreshing Kalshi markets...');
                    loadKalshiMarkets();
                }, 120000);
            }
        });
    </script>
</body>
</html>
