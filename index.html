<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    
    <title>The Culture War - Choose Your Pill</title>
    <meta name="description" content="The Culture War - A gamer's perspective on society. Matrix-themed retro website. Choose the red pill or blue pill.">
    <meta name="keywords" content="gaming, culture war, matrix, red pill, blue pill, cyberpunk, retro gaming, social commentary">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.tiktok.com">
    <link rel="preconnect" href="https://pilled.net">
    
    <!-- Blockchain SDKs -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    <script src="https://unpkg.com/@coinbase/wallet-sdk@3.7.1/dist/index.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Press Start 2P', monospace;
            background: #000;
            color: #0f0;
            overflow-x: hidden;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
            will-change: transform;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .glitch {
            animation: glitch 1s infinite;
        }

        @keyframes glitch {
            0% { text-shadow: 2px 2px #ff00ff, -2px -2px #00ffff; }
            25% { text-shadow: -2px 2px #ff00ff, 2px -2px #00ffff; }
            50% { text-shadow: 2px -2px #ff00ff, -2px 2px #00ffff; }
            75% { text-shadow: -2px -2px #ff00ff, 2px 2px #00ffff; }
            100% { text-shadow: 2px 2px #ff00ff, -2px -2px #00ffff; }
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 4px solid #0f0;
            margin-bottom: 40px;
        }

        h1 {
            font-size: clamp(1.2em, 5vw, 2.5em);
            margin-bottom: 20px;
            text-shadow: 0 0 20px #0f0;
            word-wrap: break-word;
        }

        .subtitle {
            font-size: clamp(0.5em, 2vw, 0.8em);
            color: #0f0;
            margin: 20px 0;
            line-height: 1.8;
        }

        .image-container {
            width: 100%;
            max-width: 800px;
            margin: 40px auto;
            border: 4px solid #0f0;
            box-shadow: 0 0 30px #0f0;
            position: relative;
            overflow: hidden;
        }

        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            filter: contrast(1.2) brightness(0.9);
        }

        .intro-box {
            background: rgba(0, 20, 0, 0.9);
            border: 3px solid #0f0;
            padding: clamp(20px, 5vw, 30px);
            margin: 40px auto;
            max-width: 700px;
            box-shadow: 0 0 20px #0f0;
        }

        .intro-box p {
            font-size: clamp(0.5em, 1.5vw, 0.7em);
            line-height: 2;
            text-align: center;
        }

        .pill-container {
            display: flex;
            justify-content: center;
            gap: clamp(20px, 5vw, 60px);
            margin: 60px 0;
            flex-wrap: wrap;
        }

        .pill {
            background: rgba(0, 20, 0, 0.8);
            border: 3px solid;
            padding: clamp(20px, 4vw, 30px);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            min-width: clamp(150px, 30vw, 200px);
            text-align: center;
            touch-action: manipulation;
        }

        .pill:active {
            transform: scale(0.95);
        }

        .pill:hover {
            transform: scale(1.05);
        }

        .red-pill {
            border-color: #ff0000;
            color: #ff0000;
        }

        .red-pill:hover, .red-pill:active {
            box-shadow: 0 0 40px #ff0000;
            background: rgba(255, 0, 0, 0.2);
        }

        .blue-pill {
            border-color: #0088ff;
            color: #0088ff;
        }

        .blue-pill:hover, .blue-pill:active {
            box-shadow: 0 0 40px #0088ff;
            background: rgba(0, 136, 255, 0.2);
        }

        .pill h2 {
            font-size: clamp(0.8em, 2vw, 1.2em);
            margin-bottom: 20px;
        }

        .pill p {
            font-size: clamp(0.4em, 1.2vw, 0.6em);
            line-height: 1.8;
        }

        .counter {
            margin-top: 20px;
            font-size: clamp(0.5em, 1.5vw, 0.8em);
        }

        .wallet-section {
            text-align: center;
            margin: 60px auto;
            max-width: 800px;
            background: rgba(0, 20, 0, 0.9);
            border: 4px solid #0052FF;
            padding: clamp(20px, 5vw, 40px);
            box-shadow: 0 0 40px #0052FF;
        }

        .wallet-section h2 {
            font-size: clamp(0.8em, 2.5vw, 1.2em);
            margin-bottom: 10px;
            color: #0052FF;
            text-shadow: 0 0 10px #0052FF;
        }

        .wallet-subtitle {
            font-size: clamp(0.4em, 1vw, 0.5em);
            color: #0f0;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .coinbase-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: #0052FF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
        }

        .wallet-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 20px 40px;
            background: rgba(0, 82, 255, 0.2);
            border: 3px solid #0052FF;
            color: #0052FF;
            text-decoration: none;
            font-size: clamp(0.6em, 1.5vw, 0.8em);
            transition: all 0.3s;
            cursor: pointer;
            touch-action: manipulation;
            box-shadow: 0 0 20px #0052FF;
            width: 100%;
            max-width: 400px;
            font-family: 'Press Start 2P', monospace;
        }

        .wallet-button:hover,
        .wallet-button:active {
            background: rgba(0, 82, 255, 0.4);
            transform: scale(1.05);
            box-shadow: 0 0 40px #0052FF;
        }

        .wallet-button.connected {
            border-color: #14F195;
            color: #14F195;
            box-shadow: 0 0 20px #14F195;
            background: rgba(20, 241, 149, 0.2);
        }

        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .balance-card {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #0052FF;
            padding: 25px;
            text-align: left;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(0, 82, 255, 0.3);
        }

        .balance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(0, 82, 255, 0.6);
        }

        .balance-card.hidden {
            display: none;
        }

        .chain-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0052FF;
        }

        .chain-icon {
            font-size: 1.5em;
        }

        .chain-name {
            font-size: 0.7em;
            color: #0052FF;
            text-transform: uppercase;
            font-weight: bold;
        }

        .balance-amount {
            font-size: 1.2em;
            color: #fff;
            margin-bottom: 8px;
            text-shadow: 0 0 10px #0052FF;
        }

        .balance-usd {
            font-size: 0.6em;
            color: #14F195;
        }

        .balance-loading {
            font-size: 0.6em;
            color: #888;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .wallet-info-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #0f0;
        }

        .wallet-address-display {
            font-size: 0.5em;
            color: #0f0;
            word-break: break-all;
            margin-bottom: 15px;
        }

        .wallet-address-display p {
            margin: 5px 0;
        }

        .total-balance {
            font-size: 0.8em;
            color: #fff;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 82, 255, 0.2);
            border: 2px solid #0052FF;
        }

        .total-balance-label {
            font-size: 0.6em;
            color: #0052FF;
            margin-bottom: 10px;
        }

        .total-balance-amount {
            font-size: 1.5em;
            color: #14F195;
            text-shadow: 0 0 15px #14F195;
        }

        .disconnect-button {
            margin-top: 20px;
            padding: 12px 30px;
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            color: #ff0000;
            font-size: 0.6em;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Press Start 2P', monospace;
        }

        .disconnect-button:hover,
        .disconnect-button:active {
            background: rgba(255, 0, 0, 0.4);
            box-shadow: 0 0 20px #ff0000;
            transform: scale(1.05);
        }

        .refresh-button {
            margin-top: 15px;
            padding: 10px 25px;
            background: rgba(0, 82, 255, 0.2);
            border: 2px solid #0052FF;
            color: #0052FF;
            font-size: 0.5em;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Press Start 2P', monospace;
        }

        .refresh-button:hover {
            background: rgba(0, 82, 255, 0.4);
            box-shadow: 0 0 15px #0052FF;
        }

        /* KALSHI SECTION */
        .kalshi-section {
            margin: 60px auto;
            max-width: 1000px;
            background: rgba(0, 20, 0, 0.9);
            border: 4px solid #0f0;
            padding: clamp(20px, 5vw, 40px);
            box-shadow: 0 0 40px #0f0;
        }

        .kalshi-section h2 {
            font-size: clamp(0.8em, 2.5vw, 1.2em);
            margin-bottom: 30px;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
            text-align: center;
        }

        .kalshi-markets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .kalshi-market {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #0f0;
            padding: 20px;
            transition: all 0.3s;
        }

        .kalshi-market:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
        }

        .market-title {
            font-size: 0.7em;
            color: #fff;
            margin-bottom: 15px;
            line-height: 1.4;
            min-height: 60px;
        }

        .market-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.5em;
            color: #888;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        }

        .market-category {
            color: #0f0;
        }

        .market-prices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .price-yes, .price-no {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid;
            padding: 10px;
            text-align: center;
        }

        .price-yes {
            border-color: #00ff00;
        }

        .price-no {
            border-color: #ff0000;
        }

        .price-label {
            display: block;
            font-size: 0.5em;
            margin-bottom: 5px;
        }

        .price-value {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
        }

        .market-link {
            display: block;
            text-align: center;
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            color: #0f0;
            text-decoration: none;
            font-size: 0.5em;
            transition: all 0.3s;
        }

        .market-link:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 15px #0f0;
        }

        .stream-container {
            margin: 60px auto;
            max-width: 1000px;
            background: rgba(0, 20, 0, 0.9);
            border: 4px solid #0f0;
            padding: clamp(10px, 3vw, 20px);
            box-shadow: 0 0 40px #0f0;
            position: relative;
        }

        .stream-frame {
            position: relative;
            background: #000;
            border: 2px solid #0f0;
        }

        .live-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff0000;
            color: #fff;
            padding: clamp(5px, 1.5vw, 8px) clamp(10px, 2.5vw, 15px);
            font-size: clamp(0.4em, 1.2vw, 0.6em);
            z-index: 10;
            border: 2px solid #fff;
            box-shadow: 0 0 20px #ff0000;
            animation: livepulse 2s infinite;
        }

        @keyframes livepulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .stream-frame iframe {
            display: block;
            width: 100%;
            height: clamp(300px, 60vh, 95vh);
            border: none;
        }

        .tiktok-container {
            margin: 60px auto;
            max-width: 780px;
            background: rgba(0, 20, 0, 0.9);
            border: 4px solid #0f0;
            padding: clamp(20px, 5vw, 30px);
            box-shadow: 0 0 40px #0f0;
            text-align: center;
            overflow: hidden;
        }

        .tiktok-container h2 {
            font-size: clamp(0.8em, 2.5vw, 1.2em);
            margin-bottom: 30px;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }

        .tiktok-embed-desktop {
            display: block;
            width: 100%;
            overflow: hidden;
        }

        .tiktok-embed {
            max-width: 100% !important;
            width: 100% !important;
            margin: 0 auto !important;
        }

        .tiktok-button-mobile {
            display: none;
        }

        .tiktok-cta {
            display: block;
            background: rgba(0, 20, 0, 0.95);
            border: 3px solid #0f0;
            padding: 30px;
            color: #0f0;
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 0 20px #0f0;
            cursor: pointer;
        }

        .tiktok-cta:active {
            transform: scale(0.95);
            box-shadow: 0 0 40px #0f0;
            background: rgba(0, 255, 0, 0.2);
        }

        .tiktok-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .tiktok-username {
            font-size: 1em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #0f0;
        }

        .tiktok-action {
            font-size: 0.6em;
            opacity: 0.8;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.3; }
        }

        .link-box {
            text-align: center;
            margin: 60px 0;
        }

        .cta-button {
            display: inline-block;
            padding: clamp(15px, 3vw, 20px) clamp(30px, 6vw, 40px);
            background: rgba(0, 20, 0, 0.8);
            border: 3px solid #0f0;
            color: #0f0;
            text-decoration: none;
            font-size: clamp(0.5em, 1.5vw, 0.8em);
            transition: all 0.3s;
            box-shadow: 0 0 20px #0f0;
            touch-action: manipulation;
        }

        .cta-button:hover, .cta-button:active {
            background: rgba(0, 255, 0, 0.2);
            transform: scale(1.05);
            box-shadow: 0 0 40px #0f0;
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 0, 0, 0.15) 3px
            );
            pointer-events: none;
            z-index: 999;
        }

        .section-divider {
            text-align: center;
            margin: 80px 0 40px 0;
            font-size: clamp(0.8em, 2.5vw, 1.5em);
            color: #0f0;
            text-shadow: 0 0 20px #0f0;
        }

        footer {
            text-align: center;
            padding: 40px 0;
            border-top: 4px solid #0f0;
            margin-top: 60px;
            font-size: clamp(0.4em, 1.2vw, 0.6em);
            line-height: 1.8;
        }

        .loader {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            min-height: 100px;
        }

        .loader:after {
            content: '';
            display: block;
            width: 30px;
            height: 30px;
            box-sizing: border-box;
            margin: 0;
            border: 2px solid #0f0;
            border-right-color: transparent;
            border-radius: 100%;
            animation: spinner .65s infinite linear;
            transform-origin: center;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-msg {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 14px;
            color: #ff0000;
            padding: 20px;
            font-weight: 400;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .tiktok-embed-desktop {
                display: none !important;
            }

            .tiktok-button-mobile {
                display: block;
            }

            .kalshi-markets {
                grid-template-columns: 1fr;
            }

            .stream-frame iframe {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>
    <div class="scanlines"></div>
    
    <div class="container">
        <header>
            <h1 class="glitch">THE CULTURE WAR</h1>
            <p class="subtitle">‚öîÔ∏è A Digital Battlefield ‚öîÔ∏è</p>
        </header>

        <div class="image-container">
            <img src="522d5da8-a9f1-44b8-b5d2-e95f7e37ed99.jpg" alt="The Culture War Split Reality" loading="lazy">
        </div>

        <div class="intro-box">
            <p>
                > I'M JUST SOME GUY ON THE INTERNET<br>
                > A GAMER WHO OBSERVES OUR<br>
                > CHAOTIC STUPID SOCIETY<br><br>
                > WELCOME TO THE SIMULATION_
            </p>
        </div>

        <div class="pill-container">
            <div class="pill red-pill" onclick="choosePill('red')" role="button" tabindex="0" aria-label="Choose Red Pill">
                <h2>RED PILL üíä</h2>
                <p>WAKE UP<br>SEE THE TRUTH<br>FACE REALITY<br>NO GOING BACK</p>
                <div class="counter">CHOSEN: <span id="red-count">0</span></div>
            </div>

            <div class="pill blue-pill" onclick="choosePill('blue')" role="button" tabindex="0" aria-label="Choose Blue Pill">
                <h2>BLUE PILL üíä</h2>
                <p>STAY ASLEEP<br>IGNORANCE IS BLISS<br>COMFORTABLE LIES<br>DREAM ON</p>
                <div class="counter">CHOSEN: <span id="blue-count">0</span></div>
            </div>
        </div>

        <div class="section-divider">
            &gt;&gt;&gt; COINBASE WALLET CONNECTION &lt;&lt;&lt;
        </div>

        <div class="wallet-section">
            <div class="coinbase-logo">üü¶</div>
            <h2>CONNECT COINBASE WALLET</h2>
            <p class="wallet-subtitle">
                ACCESS YOUR SOLANA & ETHEREUM BALANCES<br>
                MULTI-CHAIN SUPPORT ‚Ä¢ SECURE CONNECTION
            </p>
            
            <button id="coinbaseButton" class="wallet-button" onclick="connectCoinbase()">
                <span>üîó</span>
                <span>CONNECT WALLET</span>
            </button>

            <div id="walletInfo" style="display: none;">
                <div class="wallet-info-section">
                    <div class="wallet-address-display">
                        <p><strong>ETHEREUM ADDRESS:</strong></p>
                        <p id="ethAddress">Not connected</p>
                        <p style="margin-top: 15px;"><strong>SOLANA ADDRESS:</strong></p>
                        <p id="solAddress">Not connected</p>
                    </div>

                    <div class="balance-grid">
                        <div id="ethCard" class="balance-card hidden">
                            <div class="chain-header">
                                <div class="chain-icon">üíé</div>
                                <div class="chain-name">ETHEREUM</div>
                            </div>
                            <div class="balance-amount" id="ethBalance">
                                <span class="balance-loading">Loading...</span>
                            </div>
                            <div class="balance-usd" id="ethUsd">$0.00 USD</div>
                        </div>

                        <div id="solanaCard" class="balance-card hidden">
                            <div class="chain-header">
                                <div class="chain-icon">‚ö°</div>
                                <div class="chain-name">SOLANA</div>
                            </div>
                            <div class="balance-amount" id="solBalance">
                                <span class="balance-loading">Loading...</span>
                            </div>
                            <div class="balance-usd" id="solUsd">$0.00 USD</div>
                        </div>
                    </div>

                    <div class="total-balance">
                        <div class="total-balance-label">TOTAL PORTFOLIO VALUE</div>
                        <div class="total-balance-amount" id="totalBalance">$0.00</div>
                    </div>

                    <button class="refresh-button" onclick="refreshBalances()">
                        üîÑ REFRESH BALANCES
                    </button>

                    <button class="disconnect-button" onclick="disconnectWallet()">
                        ‚ùå DISCONNECT WALLET
                    </button>
                </div>
            </div>
        </div>

        <div class="section-divider">
            &gt;&gt;&gt; KALSHI PREDICTION MARKETS &lt;&lt;&lt;
        </div>

        <div class="kalshi-section">
            <h2>üìä LIVE PREDICTION MARKETS</h2>
            <div id="kalshiMarkets" class="kalshi-markets">
                <div class="loader"></div>
            </div>
        </div>

        <div class="section-divider">
            &gt;&gt;&gt; LIVE TRANSMISSION &lt;&lt;&lt;
        </div>

        <div class="stream-container">
            <div class="stream-frame">
                <div class="live-indicator">‚óè LIVE STREAM</div>
                <iframe 
                    allow="autoplay" 
                    allowfullscreen 
                    loading="lazy"
                    src="https://pilled.net/foxhole/141114/iframe?theme=galaxy" 
                    title="Live Stream"
                    style="height: 95vh; width: 100%; display: block;">
                </iframe>
            </div>
        </div>

        <div class="section-divider">
            &gt;&gt;&gt; SOCIAL TRANSMISSION &lt;&lt;&lt;
        </div>

        <div class="tiktok-container">
            <h2>FOLLOW THE RABBIT</h2>
            
            <div class="tiktok-embed-desktop">
                <blockquote 
                    class="tiktok-embed" 
                    cite="https://www.tiktok.com/@the.culture.war" 
                    data-unique-id="the.culture.war" 
                    data-embed-type="creator" 
                    style="max-width: 100%; margin: 0 auto;">
                    <section> 
                        <a target="_blank" href="https://www.tiktok.com/@the.culture.war?refer=creator_embed">
                            @the.culture.war
                        </a> 
                    </section> 
                </blockquote>
            </div>

            <div class="tiktok-button-mobile">
                <a href="https://www.tiktok.com/@the.culture.war" target="_blank" rel="noopener" class="tiktok-cta">
                    <div class="tiktok-icon">üì±</div>
                    <div class="tiktok-username">@the.culture.war</div>
                    <div class="tiktok-action">TAP TO FOLLOW &gt;&gt;&gt;</div>
                </a>
            </div>
        </div>

        <div class="link-box">
            <a href="https://thecaptainslog.xyz" class="cta-button" target="_blank" rel="noopener">
                &gt; ENTER THE CAPTAIN'S LOG_
            </a>
        </div>

        <footer>
            <p>&gt; THE CULTURE WAR - SOLANA BLOCKCHAIN</p>
            <p>&gt; POWERED BY CHAOS AND OBSERVATIONS</p>
            <p>&gt; MADE BY JUST SOME GUY‚Ñ¢</p>
        </footer>
    </div>

    <script async src="https://www.tiktok.com/embed.js"></script>
    <script>
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const matrix = "THECULTUREWAR01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà";
        const fontSize = isMobile ? 12 : 14;
        const columns = Math.floor(canvas.width / fontSize);
        const drops = Array(columns).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0f0';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = matrix[Math.floor(Math.random() * matrix.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        const animationSpeed = isMobile ? 80 : 50;
        setInterval(drawMatrix, animationSpeed);

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }, 250);
        });

        // ==========================================
        // COINBASE WALLET INTEGRATION
        // ==========================================
        
        let coinbaseWallet = null;
        let ethereumProvider = null;
        let ethAddress = null;
        let solAddress = null;
        let ethBalance = 0;
        let solBalance = 0;

        let prices = {
            ethereum: 0,
            solana: 0
        };

        function initCoinbaseWallet() {
            const CoinbaseWalletSDK = window.CoinbaseWalletSDK;
            coinbaseWallet = new CoinbaseWalletSDK({
                appName: 'The Culture War',
                appLogoUrl: 'https://theculturewar.github.io/logo.png',
                darkMode: true,
                overrideIsMetaMask: false
            });
            
            ethereumProvider = coinbaseWallet.makeWeb3Provider(
                'https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161',
                1
            );
        }

        async function getCryptoPrices() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum,solana&vs_currencies=usd');
                const data = await response.json();
                prices.ethereum = data.ethereum.usd;
                prices.solana = data.solana.usd;
                console.log('üìä Prices:', prices);
            } catch (error) {
                console.error('Price error:', error);
                prices.ethereum = 2500;
                prices.solana = 100;
            }
        }

        async function connectCoinbase() {
            try {
                if (!coinbaseWallet) {
                    initCoinbaseWallet();
                }

                document.getElementById('coinbaseButton').innerHTML = '<span>‚è≥</span><span>CONNECTING...</span>';

                await getCryptoPrices();

                const accounts = await ethereumProvider.request({
                    method: 'eth_requestAccounts'
                });
                
                ethAddress = accounts[0];
                
                console.log('‚úÖ Connected:', ethAddress);

                const userSolAddress = prompt(
                    '‚ö° Enter your Solana address from Coinbase Wallet:\n\n' +
                    '(Find in Coinbase Wallet app under Solana)'
                );

                if (userSolAddress && userSolAddress.length > 30) {
                    solAddress = userSolAddress.trim();
                }

                updateWalletUI();
                await refreshBalances();
                
                if (navigator.vibrate) {
                    navigator.vibrate([50, 100, 50]);
                }
                
            } catch (error) {
                console.error('Connection error:', error);
                alert('‚ö†Ô∏è CONNECTION FAILED\n\n' + error.message);
                document.getElementById('coinbaseButton').innerHTML = '<span>üîó</span><span>CONNECT WALLET</span>';
            }
        }

        function updateWalletUI() {
            document.getElementById('coinbaseButton').classList.add('connected');
            document.getElementById('coinbaseButton').innerHTML = '<span>‚úÖ</span><span>CONNECTED</span>';
            
            document.getElementById('ethAddress').textContent = ethAddress;
            document.getElementById('solAddress').textContent = solAddress || 'Not provided';
            
            document.getElementById('walletInfo').style.display = 'block';
            document.getElementById('ethCard').classList.remove('hidden');
            
            if (solAddress) {
                document.getElementById('solanaCard').classList.remove('hidden');
            }
        }

        async function getEthereumBalance() {
            try {
                document.getElementById('ethBalance').innerHTML = '<span class="balance-loading">Loading...</span>';
                
                const balanceHex = await ethereumProvider.request({
                    method: 'eth_getBalance',
                    params: [ethAddress, 'latest']
                });
                
                const balanceWei = parseInt(balanceHex, 16);
                ethBalance = balanceWei / 1e18;
                
                const ethUsdValue = (ethBalance * prices.ethereum).toFixed(2);
                
                document.getElementById('ethBalance').textContent = ethBalance.toFixed(6) + ' ETH';
                document.getElementById('ethUsd').textContent = '$' + ethUsdValue + ' USD';
                
                return parseFloat(ethUsdValue);
                
            } catch (error) {
                console.error('ETH error:', error);
                document.getElementById('ethBalance').textContent = 'Error';
                return 0;
            }
        }

        async function getSolanaBalance() {
            if (!solAddress) return 0;

            try {
                document.getElementById('solBalance').innerHTML = '<span class="balance-loading">Loading...</span>';
                
                const connection = new solanaWeb3.Connection(
                    solanaWeb3.clusterApiUrl('mainnet-beta'),
                    'confirmed'
                );
                
                const publicKey = new solanaWeb3.PublicKey(solAddress);
                const balanceLamports = await connection.getBalance(publicKey);
                
                solBalance = balanceLamports / solanaWeb3.LAMPORTS_PER_SOL;
                
                const solUsdValue = (solBalance * prices.solana).toFixed(2);
                
                document.getElementById('solBalance').textContent = solBalance.toFixed(6) + ' SOL';
                document.getElementById('solUsd').textContent = '$' + solUsdValue + ' USD';
                
                return parseFloat(solUsdValue);
                
            } catch (error) {
                console.error('SOL error:', error);
                document.getElementById('solBalance').textContent = 'Error';
                return 0;
            }
        }

        async function refreshBalances() {
            try {
                await getCryptoPrices();
                
                const ethUsd = await getEthereumBalance();
                const solUsd = await getSolanaBalance();
                
                const total = ethUsd + solUsd;
                document.getElementById('totalBalance').textContent = '$' + total.toFixed(2);
                
            } catch (error) {
                console.error('Refresh error:', error);
            }
        }

        function disconnectWallet() {
            if (confirm('Disconnect Coinbase Wallet?')) {
                ethAddress = null;
                solAddress = null;
                
                document.getElementById('coinbaseButton').classList.remove('connected');
                document.getElementById('coinbaseButton').innerHTML = '<span>üîó</span><span>CONNECT WALLET</span>';
                document.getElementById('walletInfo').style.display = 'none';
                document.getElementById('ethCard').classList.add('hidden');
                document.getElementById('solanaCard').classList.add('hidden');
                
                if (ethereumProvider && ethereumProvider.disconnect) {
                    ethereumProvider.disconnect();
                }
            }
        }

        // ==========================================
        // KALSHI MARKETS - SIMPLE PUBLIC API (NO AUTH)
        // ==========================================
        
        const KALSHI_BASE_URL = 'https://api.kalshi.co/trade-api/v2';

        async function loadKalshiMarkets() {
            const kalshiSection = document.getElementById('kalshiMarkets');
            
            if (!kalshiSection) {
                console.log('Kalshi section not found');
                return;
            }
            
            kalshiSection.innerHTML = '<div class="loader"></div>';
            
            try {
                console.log('üìä Loading Kalshi markets...');
                
                const response = await fetch(`${KALSHI_BASE_URL}/markets?limit=10&status=open`, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Markets loaded:', data);
                
                if (data.markets && data.markets.length > 0) {
                    displayKalshiMarkets(data.markets);
                } else {
                    kalshiSection.innerHTML = '<p class="error-msg">No active markets</p>';
                }
                
            } catch (error) {
                console.error('‚ùå Kalshi error:', error);
                kalshiSection.innerHTML = `
                    <div class="error-msg">
                        <p>Could not load markets</p>
                        <p style="font-size:12px;margin-top:10px;">${error.message}</p>
                    </div>
                `;
            }
        }

        function displayKalshiMarkets(markets) {
            const kalshiSection = document.getElementById('kalshiMarkets');
            
            const html = markets.slice(0, 6).map(market => {
                const title = market.title || 'Unknown Market';
                const category = market.category || 'General';
                const volume = market.volume || 0;
                const yesPrice = market.yes_ask || market.last_price || '‚Äî';
                const noPrice = market.no_ask || (100 - (market.last_price || 0)) || '‚Äî';
                const ticker = market.ticker_name || '';
                
                return `
                    <div class="kalshi-market">
                        <div class="market-title">${title}</div>
                        <div class="market-info">
                            <span class="market-category">${category}</span>
                            <span class="market-volume">Vol: $${volume.toLocaleString()}</span>
                        </div>
                        <div class="market-prices">
                            <div class="price-yes">
                                <span class="price-label">YES</span>
                                <span class="price-value">${yesPrice}¬¢</span>
                            </div>
                            <div class="price-no">
                                <span class="price-label">NO</span>
                                <span class="price-value">${noPrice}¬¢</span>
                            </div>
                        </div>
                        ${ticker ? `
                            <a href="https://kalshi.com/markets/${ticker}" 
                               target="_blank" 
                               rel="noopener" 
                               class="market-link">
                                View on Kalshi ‚Üí
                            </a>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            kalshiSection.innerHTML = html;
        }

        // ==========================================
        // PILL CHOICE SYSTEM
        // ==========================================
        
        let redCount = parseInt(localStorage.getItem('redPillCount')) || 0;
        let blueCount = parseInt(localStorage.getItem('bluePillCount')) || 0;
        document.getElementById('red-count').textContent = redCount;
        document.getElementById('blue-count').textContent = blueCount;

        function choosePill(color) {
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }

            if (color === 'red') {
                redCount++;
                localStorage.setItem('redPillCount', redCount);
                document.getElementById('red-count').textContent = redCount;
                alert('‚ö†Ô∏è YOU CHOSE THE RED PILL ‚ö†Ô∏è\n\nYou cannot unlearn what you know.\nThe matrix has you...\nFollow the white rabbit.');
                document.body.style.background = '#300';
                setTimeout(() => { document.body.style.background = '#000'; }, 200);
            } else {
                blueCount++;
                localStorage.setItem('bluePillCount', blueCount);
                document.getElementById('blue-count').textContent = blueCount;
                alert('üò¥ YOU CHOSE THE BLUE PILL üò¥\n\nThe story ends here.\nYou wake up in your bed.\nYou believe whatever you want to believe.');
                document.body.style.background = '#003';
                setTimeout(() => { document.body.style.background = '#000'; }, 200);
            }
        }

        document.querySelectorAll('.pill').forEach(pill => {
            pill.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    pill.click();
                }
            });
        });

        window.addEventListener('load', () => {
            console.log('üéÆ Page loaded');
            getCryptoPrices();
            
            if (document.getElementById('kalshiMarkets')) {
                loadKalshiMarkets();
                
                // Auto-refresh markets every 2 minutes
                setInterval(() => {
                    console.log('üîÑ Refreshing Kalshi markets...');
                    loadKalshiMarkets();
                }, 120000);
            }
        });
    </script>
</body>
</html>
